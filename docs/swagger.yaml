swagger: '2.0'
info:
  title: Contact Manager API v2
  version: 2.0.0
  description: >
    Standalone backend API for a contact manager application.
    Personal refactor of the original COP4331 Team 10 LAMP backend with improved
    structure, validation, security, and error handling.
  contact:
    email: phamminhthien065@gmail.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html

schemes:
  - http

consumes:
  - application/json
produces:
  - application/json

definitions:
  Login:
    type: object
    required:
      - login
      - password
    properties:
      login:
        type: string
        example: "Thien"
      password:
        type: string
        example: "secret"

  Register:
    type: object
    required:
      - firstName
      - lastName
      - login
      - password
    properties:
      firstName:
        type: string
        example: "Minh Thien"
      lastName:
        type: string
        example: "Pham"
      login:
        type: string
        example: "johndoe"
      password:
        type: string
        example: "mypassword"

  Contact:
    type: object
    required:
      - firstName
      - lastName
      - phone
      - email
      - userID
    properties:
      firstName:
        type: string
        example: "Minh Thien"
      lastName:
        type: string
        example: "Pham"
      phone:
        type: string
        example: "1234-5789"
      email:
        type: string
        example: "hello@gmail.com"
      userID:
        type: integer
        format: int32
        example: 1

  SearchContact:
    type: object
    required:
      - userID
      - searchTerm
    properties:
      userID:
        type: integer
        format: int32
        example: 1
      searchTerm:
        type: string
        example: "Thien"

  UpdateContact:
    type: object
    required:
      - ID
      - firstName
      - lastName
      - phone
      - email
    properties:
      ID:
        type: integer
        format: int32
        example: 10
      firstName:
        type: string
        example: "Pham"
      lastName:
        type: string
        example: "Thien"
      phone:
        type: string
        example: "1111-11111"
      email:
        type: string
        example: "hello@gmail.com"

  DeleteContact:
    type: object
    required:
      - id
    properties:
      id:
        type: integer
        format: int32
        example: 1

paths:
  /src/Login.php:
    post:
      tags:
        - Users
      summary: Logs in to the contact manager
      description: >
        Authenticates a user with login and password.
        On success, returns user ID, first name, and last name.
      operationId: doLogin
      parameters:
        - in: body
          name: loginItem
          description: Login credentials
          required: true
          schema:
            $ref: '#/definitions/Login'
      responses:
        200:
          description: Successful login
        400:
          description: Missing login or password
        401:
          description: Invalid login or password
        500:
          description: Server error

  /src/Register.php:
    post:
      tags:
        - Users
      summary: Registers a new user
      description: >
        Creates a new user account with a hashed password.
        Returns the new user ID and basic profile information.
      operationId: doRegister
      parameters:
        - in: body
          name: registerItem
          description: User registration data
          required: true
          schema:
            $ref: '#/definitions/Register'
      responses:
        201:
          description: User created
        400:
          description: Missing required fields
        409:
          description: Login already exists
        500:
          description: Server error

  /src/AddContact.php:
    post:
      tags:
        - Contacts
      summary: Adds a contact
      description: >
        Adds a new contact for the specified user.
        Validates required fields and email format.
      operationId: addContact
      parameters:
        - in: body
          name: contactItem
          description: Contact information
          required: true
          schema:
            $ref: '#/definitions/Contact'
      responses:
        201:
          description: Contact created
        400:
          description: Missing required contact fields or invalid email format
        500:
          description: Server error

  /src/SearchContacts.php:
    post:
      tags:
        - Contacts
      summary: Searches contacts
      description: >
        Searches contacts for a given user by a search term, matching first name,
        last name, phone, or email.
      operationId: searchContacts
      parameters:
        - in: body
          name: searchItem
          description: Contact search parameters
          required: true
          schema:
            $ref: '#/definitions/SearchContact'
      responses:
        200:
          description: Matching contacts returned
        400:
          description: Missing searchTerm or userID
        404:
          description: No contacts found
        500:
          description: Server error

  /src/UpdateContact.php:
    post:
      tags:
        - Contacts
      summary: Updates a contact
      description: >
        Updates an existing contact by ID. Validates required fields and email
        format. Returns 404 if the contact does not exist or no changes were made.
      operationId: updateContact
      parameters:
        - in: body
          name: updateItem
          description: Updated contact data
          required: true
          schema:
            $ref: '#/definitions/UpdateContact'
      responses:
        200:
          description: Contact updated successfully
        400:
          description: Missing required contact fields or invalid email format
        404:
          description: Contact not found or no changes made
        500:
          description: Server error

  /src/DeleteContact.php:
    post:
      tags:
        - Contacts
      summary: Deletes a contact
      description: >
        Deletes a contact by ID. Returns 404 if the contact does not exist.
      operationId: deleteContact
      parameters:
        - in: body
          name: deleteItem
          description: Contact to delete
          required: true
          schema:
            $ref: '#/definitions/DeleteContact'
      responses:
        200:
          description: Contact deleted successfully
        400:
          description: Missing contact ID
        404:
          description: Contact not found
        500:
          description: Server error
